<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="horanet_operation_view_form" model="ir.ui.view">
        <field name="name">horanet operation form</field>
        <field name="model">horanet.operation</field>
        <field name="arch" type="xml">
            <form string="operation" duplicate="false">
                <header>
                    <button name="action_force_recompute" type="object"
                            string="Force recompute"
                            attrs="{'invisible':[('disable_computation','=',True)]}"
                            groups="horanet_subscription.group_activity_rule_manager"/>
                    <button name="action_open_wizard_sandbox" type="object"
                            string="Open in sandBox"
                            groups="horanet_subscription.group_activity_rule_manager"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title oe_left">
                        <div class="oe_edit_only">
                            <label for="display_name"/>
                        </div>
                        <h1>
                            <field name="display_name"/>
                        </h1>
                    </div>
                    <group col="2">
                        <group string="Parameters" name="op_parameter">
                            <label for="quantity" string="Quantity"/>
                            <div class="o_row">
                                <field name="quantity"/>
                                <field name="activity_uom_id"/>
                            </div>
                            <field name="action_id"/>

                            <field name="device_id"/>
                            <field name="time"/>
                            <field name="activity_id"/>
                            <newline/>
                            <field name="is_offline"/>
                            <field name="disable_computation"/>
                        </group>
                        <group string="Informations" name="op_information">
                            <field name="tag_id"/>
                            <field name="partner_id"/>
                            <field name="operation_partner_id"/>
                            <field name="query_id"/>
                            <newline/>
                            <field name="check_point_id"/>
                            <field name="infrastructure_id"/>
                            <field name="activity_sector_id"/>
                            <newline/>
                            <field name="origin_operation_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Engine result" groups="horanet_subscription.group_activity_rule_manager"
                              attrs="{'invisible':[('disable_computation','=',True)]}">
                            <group>
                                <field name="resulting_engine_result_id" readonly="1"/>
                            </group>
                            <group col="1">
                                <separator string="Execution log"/>
                                <field name="resulting_execution_log" nolabel="1" widget="html" readonly="1"/>
                                <separator string="Resulting objects"/>
                                <label for='resulting_usage_ids'/>
                                <field name='resulting_usage_ids' nolabel="1"/>
                                <label for='resulting_operation_ids'/>
                                <field name='resulting_operation_ids' nolabel="1"/>
                            </group>

                        </page>
                        <page string="Engine origin" groups="horanet_subscription.group_activity_rule_manager">
                            <group col="2">
                                <field name="origin_engine_result_id" readonly="1"/>
                                <field name="origin_operation_id" readonly="1"
                                       attrs="{'invisible': [('origin_operation_id', '=', False)]}"/>
                                <field name="origin_query_id" readonly="1"
                                       attrs="{'invisible': [('origin_query_id', '=', False)]}"/>
                            </group>
                            <group col="1">
                                <separator string="Execution log"/>
                                <field name="origin_execution_log" nolabel="1" widget="html" readonly="1"/>
                            </group>
                        </page>
                        <page string="Sale order lines">
                            <field name="sale_order_line_ids">
                                <tree>
                                    <field name="product_id"/>
                                    <field name="name"/>
                                    <field name="product_uom_qty"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="horanet_operation_view_tree" model="ir.ui.view">
        <field name="name">horanet operation tree</field>
        <field name="model">horanet.operation</field>
        <field name="arch" type="xml">
            <tree string="operation"
                  decoration-success="state in ['done','processed']"
                  decoration-muted="state=='null'"
                  decoration-warning="state=='pending'"
                  decoration-bf="state=='error'"
                  decoration-danger="state=='error'">
                <field name="id"/>
                <field name="time"/>
                <field name="device_id"/>
                <field name="operation_partner_id"/>
                <field name="action_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="horanet_operation_view_pivot">
        <field name="name">horanet operation tree</field>
        <field name="model">horanet.operation</field>
        <field name="arch" type="xml">
            <pivot string="Pivot Operations" disable_linking="True">
                <field name="time"/>
                <field name="activity_id"/>
            </pivot>
        </field>
    </record>

    <record id="view_filter_horanet_operation" model="ir.ui.view">
        <field name="name">Operation search view</field>
        <field name="model">horanet.operation</field>
        <field name="arch" type="xml">
            <search string="Search Operation">
                <field name="device_id"/>
                <field name="operation_partner_id" string="Linked partner"/>
                <field name="action_id"/>
                <field name="tag_id" string="Tag" filter_domain="[('tag_id.number','ilike',self)]"/>
                <filter string="Is error" name="message_needaction" domain="[('state', '=', 'error')]"/>
                <filter string="Today" name="filter_today"
                        domain="[('time', '&lt;=', time.strftime('%Y-%m-%d 23:59:59')),
                        ('time', '&gt;=', time.strftime('%Y-%m-%d 00:00:00'))]"/>
                <filter string="This week" name="filter_week"
                        domain="[('time', '&lt;=', time.strftime('%Y-%m-%d 23:59:59')),('time', '&gt;=', ((context_today()+relativedelta(weeks=-1, days=1, weekday=0)).strftime('%Y-%m-%d 00:00:00')))]"/>
                <filter string="This month" name="filter_month"
                        domain="[('time', '&lt;=', time.strftime('%Y-%m-%d 23:59:59')),('time', '&gt;=', time.strftime('%Y-%m-01 00:00:00'))]"/>
                <filter string="This Year" name="filter_year"
                        domain="[('time','&lt;=',time.strftime('%%Y-12-31 23:59:59')),('time','&gt;=',time.strftime('%%Y-01-01 00:00:00'))]"/>
                <group expand="0" string="Group By">
                    <filter string="State" name="groupby_state" domain="[]" context="{'group_by':'state'}"/>
                    <filter name="group_by_date" string="Date" context="{'group_by': 'time'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_horanet_operation" model="ir.actions.act_window">
        <field name="name">operation</field>
        <field name="res_model">horanet.operation</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,pivot</field>
        <field name="context">{'display_partner_in_tag_name':True}</field>
        <field name="search_view_id" ref="view_filter_horanet_operation"></field>
    </record>
</odoo>
